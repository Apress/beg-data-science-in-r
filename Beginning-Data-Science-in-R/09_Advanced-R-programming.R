## ------------------------------------------------------------------------
(x <- 2 / 3)
(y <- x ** 2)

## ------------------------------------------------------------------------
(x <- 1:4 / 3)
(y <- x ** 2)

## ------------------------------------------------------------------------
x <- 1:5
y <- 6:10

## ------------------------------------------------------------------------
(z <- x + y)

## ------------------------------------------------------------------------
z <- vector(length = length(x))
for (i in seq_along(x)) {
    z[i] <- x[i] + y[i]
}
z

## ------------------------------------------------------------------------
sqrt((1:5)**2)
sin(sqrt((1:5)**2))

## ------------------------------------------------------------------------
x <- 1:10
y <- 1:2
x + y
z <- 1:3
x + z

## ------------------------------------------------------------------------
z <- 1:3
x + z

## ------------------------------------------------------------------------
(x <- 1:4 / 3)
(y <- x ** 2)

## ------------------------------------------------------------------------
x <- 1:10
if (x %% 2 == 0) 5 else 15

## ------------------------------------------------------------------------
x <- 1:10
ifelse(x %% 2 == 0, 5, 15)

## ------------------------------------------------------------------------
f <- function(x, y) sqrt(x ** y)
f(1:6, 2)
f(1:6, 1:2)

## ------------------------------------------------------------------------
role_table <- list("Thomas" = "Instructor", 
                   "Henrik" = "Student",
                   "Kristian" = "Student",
                   "Randi" = "Student",
                   "Heidi" = "Student",
                   "Manfred" = "Student")

map_to_role <- function(name) role_table[[name]]

## ------------------------------------------------------------------------
map_to_role("Thomas")
map_to_role("Henrik")

## ------------------------------------------------------------------------
x <- c("Thomas", "Henrik", "Randi")
map_to_role(x)

## ------------------------------------------------------------------------
map_to_role <- Vectorize(map_to_role)
map_to_role(x)

## ------------------------------------------------------------------------
role_table[c("Thomas", "Henrik", "Randi")]

## ------------------------------------------------------------------------
map_to_role_2 <- function(names) unlist(role_table[names])

x <- c("Thomas", "Henrik", "Randi")
map_to_role_2(x)

## ------------------------------------------------------------------------
x <- list("first" = list("second" = "foo"), "third" = "bar")
x[[c("first", "second")]]

## ------------------------------------------------------------------------
x[["first"]][["second"]]

## ------------------------------------------------------------------------
m <- matrix(1:6, nrow=2, byrow=TRUE)
m

## ------------------------------------------------------------------------
apply(m, 1, function(x) paste(x, collapse = ":"))

## ------------------------------------------------------------------------
apply(m, 2, function(x) paste(x, collapse = ":"))

## ------------------------------------------------------------------------
apply(m, c(1, 2), function(x) paste(x, collapse = ":"))

## ------------------------------------------------------------------------
apply(m, 1, function(x) c(x,x))
apply(m, 2, function(x) c(x,x))

## ------------------------------------------------------------------------
apply(m, c(1,2), function(x) c(x,x))

## ------------------------------------------------------------------------
x <- apply(m, c(1,2), function(x) c(x,x))
k <- dim(x)[3]
n <- dim(x)[2]
for (i in 1:n) {
  for (j in 1:k) {
    print(x[,i,j])
  }
}

## ------------------------------------------------------------------------
sumpow <- function(x, n) sum(x) ** n
apply(m, 1, sumpow)

## ------------------------------------------------------------------------
apply(m, 1, sumpow, 2)

## ------------------------------------------------------------------------
apply(m, 1, sumpow, n = 2)

## ------------------------------------------------------------------------
(l <- list(1, 2, 3))
lapply(l, function(x) x**2)

## ------------------------------------------------------------------------
l <- list(a=1, b=2, c=3)
lapply(l, function(x) x**2)

## ------------------------------------------------------------------------
lapply(1:3, function(x) x**2)

## ------------------------------------------------------------------------
lapply(list(a=1:3, b=4:6), function(x) x**2)

## ------------------------------------------------------------------------
sapply(1:3, function(x) x**2)

## ------------------------------------------------------------------------
vapply(1:3, function(x) x**2, 1)

## ------------------------------------------------------------------------
2 + 2
`+`(2, 2)

## ------------------------------------------------------------------------
`%or die%` <- function(test, msg) if (!test) stop(msg)

x <- 5
(x != 0) %or die% "x should not be zero"

x <- 0
(x != 0) %or die% "x should not be zero"

## ------------------------------------------------------------------------
v <- 1:4
names(v) <- c("a", "b", "c", "d")
v

## ------------------------------------------------------------------------
`foo<-` <- function(x, value) {
  x$foo <- value
  x
}

`bar<-` <- function(x, value) {
  x$bar <- value
  x
}

x <- list(foo=1, bar=2)

x$foo
foo(x) <- 3
x$foo

x$bar
bar(x) <- 3
x$bar

## ------------------------------------------------------------------------
y <- x
foo(x) <- 5
x
y

## ------------------------------------------------------------------------

`foo<-` <- function(x, val) {
  x$foo <- val
  x
}

x <- list(foo=1, bar=2)
foo(x) <- 3

## ------------------------------------------------------------------------
`foo<-` <- function(y, value) {
  y$foo <- value
  y
}

x <- list(foo=1, bar=2)
foo(x) <- 3
x$foo

## ------------------------------------------------------------------------
`modify<-` <- function(x, variable, value) {
  x[variable] <- value
  x
}

x <- list(foo=1, bar=2)
modify(x, "foo") <- 3
modify(x, "bar") <- 4
x$foo
x$bar

## ------------------------------------------------------------------------
x <- 1:4
f <- function(x) {
  x[2] <- 5
  x
}
x
f(x)
x

## ------------------------------------------------------------------------
m <- matrix(1:6, nrow=3)
sum_of_squares <- function(x) sum(x^2)
apply(m, 1, sum_of_squares)

## ------------------------------------------------------------------------
apply(m, 1, function(x) sum(x^2))

## ------------------------------------------------------------------------
apply(m^2, 1, sum)

## ------------------------------------------------------------------------
apply_if <- function(x, p, f) {
  result <- vector(length=length(x))
  n <- 0
  for (i in seq_along(x)) {
    if (p(x[i])) {
      n <- n + 1
      result[n] <- f(x[i])
    }
  }
  head(result, n)
}

## ------------------------------------------------------------------------
apply_if(1:8, function(x) x %% 2 == 0, function(x) x^2)

## ------------------------------------------------------------------------
power <- function(n) function(x) x^n
square <- power(2)
cube <- power(3)
x <- 1:4
square(x)
cube(x)

## ------------------------------------------------------------------------
is_even <- function(x) x %% 2 == 0
Filter(is_even, 1:8)
Filter(is_even, as.list(1:8))

## ------------------------------------------------------------------------
square <- function(x) x^2
Map(square, 1:4)
unlist(Map(square, 1:4))

## ------------------------------------------------------------------------
plus <- function(x, y) x + y
unlist(Map(plus, 0:3, 3:0))

## ------------------------------------------------------------------------
add_parenthesis <- function(a, b) paste("(", a, ", ", b, ")", sep = "")
Reduce(add_parenthesis, 1:4)

## ------------------------------------------------------------------------
mysum <- function(x) Reduce(`+`, x)
sum(1:4)
mysum(1:4)

## ------------------------------------------------------------------------
cached <- function(f) {
  force(f)
  table <- list()

  function(n) {
    key <- as.character(n)
    if (key %in% names(table)) {
      print(paste("I have already computed the value for", n))
      table[[key]]

    } else {
      print(paste("Going to compute the value for", n))
      res <- f(n)
      print(paste("That turned out to be", res))
      table[key] <<- res
      print(table)
      res
    }
  }
}

## ------------------------------------------------------------------------
factorial <- function(n) {
  if (n == 1) {
    1
  } else {
    n * factorial(n - 1)
  }
}

factorial <- cached(factorial)
factorial(4)
factorial(1)
factorial(2)
factorial(3)
factorial(4)

## ------------------------------------------------------------------------
fibonacci <- function(n) {
  if (n == 1 || n == 2) {
    1
  } else {
    fibonacci(n-1) + fibonacci(n-2)
  }
}

fibonacci <- cached(fibonacci)
fibonacci(4)
fibonacci(1)
fibonacci(2)
fibonacci(3)
fibonacci(4)

## ------------------------------------------------------------------------
f <- function(a, b) NULL
f(a = 1, b = 2, c = 3)

## ------------------------------------------------------------------------
g <- function(a, b, ...) NULL
g(a = 1, b = 2, c = 3)

## ------------------------------------------------------------------------
tolist <- function(...) list(...)

tolist()
tolist(a = 1)
tolist(a = 1, b = 2)

## ------------------------------------------------------------------------
time_it <- function(f) {
  force(f)
  function(...) {
    system.time(f(...))
  }
}

## ------------------------------------------------------------------------
ti_mean <- time_it(mean)
ti_mean(runif(1e6))

## ---- echo=FALSE---------------------------------------------------------
`%.%` <- function(f,g) function(...) f(g(...))

## ------------------------------------------------------------------------
uMap <- unlist %.% Map

## ------------------------------------------------------------------------
plus <- function(x, y) x + y
unlist(Map(plus, 0:3, 3:0))
uMap(plus, 0:3, 3:0)

## ------------------------------------------------------------------------
error <- function(truth) function(x) x - truth
square <- function(x) x^2

rmse <- function(truth)
  sqrt %.% mean %.% square %.% error(truth)

mu <- 0.4
x <- rnorm(10, mean = 0.4)
rmse(mu)(x)

